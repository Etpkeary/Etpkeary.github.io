<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mybatis | 镜中月</title><meta name="keywords" content="Mybatis"><meta name="author" content="镜中月"><meta name="copyright" content="镜中月"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis">
<meta property="og:url" content="https://etpkeary.github.io/posts/6.html">
<meta property="og:site_name" content="镜中月">
<meta property="og:description" content="Mybatis">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240147521.jpg">
<meta property="article:published_time" content="2022-07-15T16:21:56.000Z">
<meta property="article:modified_time" content="2022-08-23T18:11:23.247Z">
<meta property="article:author" content="镜中月">
<meta property="article:tag" content="Mybatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240147521.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://etpkeary.github.io/posts/6"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#bfbfbf"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mybatis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-24 02:11:23'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="/css/clock.min.css" /><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="镜中月" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208230048212.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw icon-zhifeiji"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240147521.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">镜中月</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw icon-zhifeiji"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Mybatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-15T16:21:56.000Z" title="发表于 2022-07-16 00:21:56">2022-07-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-23T18:11:23.247Z" title="更新于 2022-08-24 02:11:23">2022-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Mybatis/">Mybatis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>44分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Mybatis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="什么是Mybatis"><a href="#什么是Mybatis" class="headerlink" title="什么是Mybatis"></a>什么是Mybatis</h3><p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212304236.png" alt="logo"></p>
<ul>
<li>MyBatis 是一款持久层框架</li>
<li>它支持自定义 SQL、存储过程以及高级映射。</li>
<li>MyBatis 免除了几乎所有的 JDBC 代码以及 设置参数和获取结果集的工作。</li>
<li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li>
</ul>
<h3 id="获取Mybatis"><a href="#获取Mybatis" class="headerlink" title="获取Mybatis"></a>获取Mybatis</h3><p>Maven仓库:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
<p>中文文档：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p>
<h3 id="持久层"><a href="#持久层" class="headerlink" title="持久层"></a>持久层</h3><p>数据持久化：</p>
<ul>
<li>将数据持久的存储在某个地方，例如：将内存的数据存储到硬盘，数据库，io文件（以前）</li>
</ul>
<p>持久层：</p>
<ul>
<li><p>Dao层</p>
</li>
<li><p>用来完成持久化工作的代码</p>
</li>
</ul>
<h3 id="Mybatis优势"><a href="#Mybatis优势" class="headerlink" title="Mybatis优势"></a>Mybatis优势</h3><ul>
<li>简单易学</li>
<li>灵活</li>
<li>解除sql与程序代码的耦合</li>
<li>提供映射标签，支持对象与数据库的orm字段关系映射</li>
<li>提供对象关系映射标签，支持对象关系组建维护</li>
<li>提供xml标签，支持编写动态sql。</li>
</ul>
<h2 id="第一个Mybatis程序"><a href="#第一个Mybatis程序" class="headerlink" title="第一个Mybatis程序"></a>第一个Mybatis程序</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p><strong>新建数据库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create database if not exists mybatis default charset=utf8;</span><br><span class="line"></span><br><span class="line">use mybatis;</span><br><span class="line"></span><br><span class="line">create table `user`(</span><br><span class="line">	id int(20) not null auto_increment primary key,</span><br><span class="line">	`name` varchar(30) default null,</span><br><span class="line">	`pwd` varchar(30) default null</span><br><span class="line">)ENGINE=INNODB default charset=utf8;</span><br><span class="line"></span><br><span class="line">insert into `user`(`name`,`pwd`) VALUES</span><br><span class="line">(&#x27;张三&#x27;,&#x27;123456&#x27;),</span><br><span class="line">(&#x27;李四&#x27;,&#x27;123456&#x27;),</span><br><span class="line">(&#x27;王五&#x27;,&#x27;123456&#x27;)</span><br></pre></td></tr></table></figure>
<p>新建项目</p>
<ul>
<li>新建普通Maven项目</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212312146.png" alt="image-20220721231201088"></p>
<p>这名称可以改一下</p>
<ul>
<li>删除src目录（父工程： 方便练习学习，不用多次创建项目）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212314517.png" alt="image-20220721231437466"></p>
<ul>
<li>在父工程的pom.xml中导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    Mysql驱动    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    mybatis    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    junit 单元测试    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注：如果依赖包名报红，点击idea侧边栏上的maven后，点击刷新</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212315938.png" alt="在这里插入图片描述"></p>
<p><strong>项目搭建完毕</strong></p>
<h3 id="创建一个子模块"><a href="#创建一个子模块" class="headerlink" title="创建一个子模块"></a>创建一个子模块</h3><ul>
<li>在父项目右键新建一个模块（子工程）</li>
</ul>
<p>这样可以不用每次都导包了</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212317569.png" alt="image-20220721231710522"></p>
<p>再次创建一个普通maven项目</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212312146.png" alt="image-20220721231201088"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212318551.png" alt="image-20220721231849505"></p>
<p><strong>编写mybatis核心配置文件</strong></p>
<p>在mybatis-01/src/main/resources下新建mybatis-config.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--configuration核心配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=ture&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=Asia/Shanghai&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root 你的数据库用户名&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;你的数据库密码&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;!-- 注意每个mapper.xml都要在此处注册 --&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<p><strong>编写mybatis工具类</strong></p>
<ul>
<li>在mybatis01/src/main/java下创建自己的包路径</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212321662.png" alt="image-20220721232139619"></p>
<ul>
<li>工具类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//使用mybatis的第一步</span></span><br><span class="line">      <span class="comment">//创建sqlSessionFactory对象</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">      sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//有了 SqlSessionFactory，我们可以从中获得 SqlSession 的实例.</span></span><br><span class="line">  <span class="comment">// SqlSession 提供了在数据库执行 SQL 命令所需的所有方法.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSession</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><p><strong>实体类</strong></p>
<ul>
<li>entity包下 User类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nych.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name, String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPwd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPwd</span><span class="params">(String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pwd=&#x27;&quot;</span> + pwd + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dao (或mapper) 接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>接口实现类: 由以前的类转换为xml文件：</strong></p>
<ul>
<li>UserMapper.xml:</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace= 绑定一个对应的dao/mapper接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.nych.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  查询 id对应方法名 resultType = 返回类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.nych.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select * from `user`</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>namespace: 对应一个要实现的接口</li>
<li>id: 对应接口中的方法名</li>
<li>resultType: 返回结果类型</li>
<li>还有一个 parameterType: 参数类型; 会在后面用到</li>
</ul>
<h3 id="编写测试类"><a href="#编写测试类" class="headerlink" title="编写测试类"></a>编写测试类</h3><p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212321662.png" alt="image-20220721232139619"></p>
<p>测试代码</p>
<p>junit测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//第一步： 获取SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSession();</span><br><span class="line">        <span class="comment">//方式一： getMapper（推荐使用）</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">        List&lt;User&gt; userList = userDao.getUserList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方式二： (不推荐使用)</span></span><br><span class="line">        List&lt;User&gt; userList2 = sqlSession.selectList(<span class="string">&quot;com.nych.dao.UserDao.getUserList&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (User user : userList2) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//关闭sqlSession</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212327500.png" alt="image-20220721232738446"></p>
<p><strong>总结</strong></p>
<p>写Mybatis的步骤：</p>
<ul>
<li><p>在Maven中添加依赖包</p>
</li>
<li><p>编写获取SqlSession对象的工具类</p>
</li>
<li><p>工具类中需要mybatis 核心配置文件（mybatis-config.xml）</p>
</li>
<li><p>编写User表的实体类User.java</p>
</li>
<li><p>编写操作User的接口UserDao/UserMapper(interface)</p>
</li>
<li><p>编写实现UserDao/UserMapper的实现 UserDao.xml / UserMapper.xml</p>
</li>
<li><p>写测试类测试代码</p>
</li>
</ul>
<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><ul>
<li>增加(Create)、检索(Retrieve)、更新(Update)和删除(Delete)</li>
</ul>
<h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><ul>
<li>需求： 新增一名用户</li>
<li>实现： 在UserMapper/UserDao中写一个抽象方法</li>
</ul>
<pre><code>//新增一个用户
int addUser(User user);
</code></pre><ul>
<li>在userMapper.xml中实现该抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 新增用户 --&gt;</span><br><span class="line">&lt;insert id=&quot;addUser&quot; parameterType=&quot;com.nych.entity.User&quot;&gt;</span><br><span class="line">    insert into mybatis.user (`name`,`pwd`) values (#&#123;name&#125;,#&#123;pwd&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>测试</p>
<ul>
<li>注意： 增、删、改 三个操作都需要提交事务</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//增删改 需要提交事务</span><br><span class="line">//新增用户测试</span><br><span class="line">@Test</span><br><span class="line">public void addUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    User user = new User(&quot;新用户&quot;,&quot;000000&quot;);</span><br><span class="line">    int i = userMapper.addUser(user);</span><br><span class="line">    //提交</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    </span><br><span class="line">    if(i &gt; 0)&#123;</span><br><span class="line">        System.out.println(&quot;成功添加了&quot;+ i +&quot;个用户！&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        System.out.println(&quot;添加用户失败！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //关闭</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212330245.png" alt="image-20220721233010198"></p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><ul>
<li>需求： 根据id查用户<ul>
<li>实现：在UserDao/UserMapper中添加抽象方法：</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//根据id查询</span><br><span class="line">User getUserById(int id);</span><br></pre></td></tr></table></figure>
<ul>
<li>在UserMapper.xml中实现接口中的抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;getUserById&quot; parameterType=&quot;int&quot; resultType=&quot;com.nych.entity.User&quot;&gt;</span><br><span class="line">    select * from `user` where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>parameterType: 参数类型</p>
</li>
<li><p>测试</p>
</li>
</ul>
<pre><code>//测试根据id查用户
@Test
public void getUserById()&#123;
    SqlSession sqlSession = MybatisUtils.getSession();
    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);

    User user = userMapper.getUserById(1);
    System.out.println(&quot;user = &quot; + user);

    sqlSession.close();
&#125;
</code></pre><ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212332059.png" alt="image-20220721233221016"></p>
<h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><ul>
<li><p>需求： 修改一个用户</p>
</li>
<li><p>实现： 在UserDao/UserMapper中添加一个抽象方法</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改用户</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>在UserMapper.xml中实现这个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--修改用户信息--&gt;</span><br><span class="line">&lt;update id=&quot;updateUser&quot; parameterType=&quot;com.nych.entity.User&quot;&gt;</span><br><span class="line">    update mybatis.user set `name` = #&#123;name&#125;,`pwd` = #&#123;pwd&#125; where id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试修改</span><br><span class="line">@Test</span><br><span class="line">public void updateUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    User user = new User(5,&quot;修改新用户&quot;,&quot;111111&quot;);</span><br><span class="line">    int i = userMapper.updateUser(user);</span><br><span class="line">	sqlSession.commit();</span><br><span class="line">    </span><br><span class="line">    if(i &gt; 0)&#123;</span><br><span class="line">        System.out.println(&quot;成功修改了&quot; + i + &quot;个用户！&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        System.out.println(&quot;修改用户失败！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //关闭</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212334500.png" alt="image-20220721233432449"></p>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><ul>
<li><p>需求：根据id删除一个用户</p>
</li>
<li><p>实现： 在UserDao/UserMapper中添加一个抽象方法</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//删除一个用户</span><br><span class="line">int deleteUser(int id);</span><br></pre></td></tr></table></figure>
<ul>
<li>在UserMapper.xml中实现这个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  删除一个用户  --&gt;</span><br><span class="line">&lt;delete id=&quot;deleteUser&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">    delete from `user` where id = #&#123;id&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
<li>测试代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试删除</span><br><span class="line">@Test</span><br><span class="line">public void deleteUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    int i = userMapper.deleteUser(5);</span><br><span class="line"></span><br><span class="line">    if(i &gt; 0)&#123;</span><br><span class="line">        System.out.println(&quot;成功删除了&quot; + i + &quot;个用户！&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        System.out.println(&quot;删除用户失败！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    //关闭</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212335464.png" alt="image-20220721233545419"></p>
<h3 id="使用Map传递参数"><a href="#使用Map传递参数" class="headerlink" title="使用Map传递参数"></a>使用Map传递参数</h3><ul>
<li>如果数据库中字段很多，实体类中的参数也很多，那么使用实体类对象来传参就不是很方便了，此时可以考虑使用Map！<ul>
<li>使用map传参，直接在sql中使用map的key即可取出参数。</li>
<li>使用对象传参，直接在sql中使用对象的属性名即可取出参数。</li>
</ul>
</li>
</ul>
<h4 id="使用Map传递参数，实现添加用户"><a href="#使用Map传递参数，实现添加用户" class="headerlink" title="使用Map传递参数，实现添加用户"></a>使用Map传递参数，实现添加用户</h4><ul>
<li>在UserDao/UserMapper中添加一个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//添加用户 map方法</span><br><span class="line">int addUser2(Map&lt;String, Object&gt; map);</span><br></pre></td></tr></table></figure>
<ul>
<li>在UserMapper.xml中实现这个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  新增用户 Map方法  --&gt;</span><br><span class="line">&lt;insert id=&quot;addUser2&quot; parameterType=&quot;map&quot;&gt;</span><br><span class="line">    insert into mybatis.user (`name`,`pwd`) values (#&#123;username&#125;,#&#123;password&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<pre><code>@Test
public void addUser2()&#123;
    SqlSession sqlSession = MybatisUtils.getSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);

    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();

    map.put(&quot;username&quot;,&quot;张三&quot;);
    map.put(&quot;password&quot;,&quot;222222A&quot;);

    int i = mapper.addUser2(map);
    if(i &gt; 0)&#123;
        System.out.println(&quot;成功插入&quot;+ i + &quot;个用户！&quot;);
    &#125;else &#123;
        System.out.println(&quot;插入失败&quot;);
    &#125;
    sqlSession.commit();
    sqlSession.close();
&#125;
</code></pre><ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212340043.png" alt="image-20220721234036994"></p>
<h4 id="使用Map传递参数，实现查询用户"><a href="#使用Map传递参数，实现查询用户" class="headerlink" title="使用Map传递参数，实现查询用户"></a>使用Map传递参数，实现查询用户</h4><ul>
<li>在UserDao/UserMapper中添加一个抽象方法</li>
</ul>
<pre><code>//根据id查用户 Map方法
User getUserById2(Map&lt;String, Object&gt; map);
</code></pre><ul>
<li>在UserMapper.xml中实现这个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;getUserById2&quot; parameterType=&quot;map&quot; resultType=&quot;com.nych.entity.User&quot;&gt;</span><br><span class="line">    select * from `user` where id = #&#123;userId&#125; and `name` = #&#123;userName&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试 使用Map传参</span><br><span class="line">@Test</span><br><span class="line">public void getUserById2()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    map.put(&quot;userId&quot;,6);</span><br><span class="line">    map.put(&quot;userName&quot;,&quot;张三&quot;);</span><br><span class="line"></span><br><span class="line">    User user = mapper.getUserById2(map);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;user = &quot; + user);</span><br><span class="line"></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试结果</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207212344948.png" alt="image-20220721234210873"></p>
<h2 id="Mybatis-模糊查询"><a href="#Mybatis-模糊查询" class="headerlink" title="Mybatis 模糊查询"></a>Mybatis 模糊查询</h2><h3 id="传递字符串”-xxx-”"><a href="#传递字符串”-xxx-”" class="headerlink" title="传递字符串”%xxx%”"></a><strong>传递字符串”%xxx%”</strong></h3><ul>
<li>在UserDao/UserMapper中添加一个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//模糊查询</span><br><span class="line">List&lt;User&gt; getUserLike(String value);</span><br></pre></td></tr></table></figure>
<ul>
<li>在UserMapper.xml中实现这个抽象方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  模糊查询用户  --&gt;</span><br><span class="line">&lt;select id=&quot;getUserLike&quot; resultType=&quot;com.nych.entity.User&quot;&gt;</span><br><span class="line">    select * from `user` where `name` like #&#123;value&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试 模糊查询1</span><br><span class="line">@Test</span><br><span class="line">public void getUserLike()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    String getUsername = &quot;张&quot;;   //假如是从前端获取到的数据</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = mapper.getUserLike(&quot;%&quot;+getUsername+&quot;%&quot;);</span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="在SQL中拼接通配符"><a href="#在SQL中拼接通配符" class="headerlink" title="在SQL中拼接通配符"></a><strong>在SQL中拼接通配符</strong></h3><ul>
<li>注意防止sql注入</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from `user` where `name` like &quot;%&quot;#&#123;value&#125;&quot;%&quot;;</span><br></pre></td></tr></table></figure>
<h2 id="配置解析"><a href="#配置解析" class="headerlink" title="配置解析"></a>配置解析</h2><h3 id="核心配置文件"><a href="#核心配置文件" class="headerlink" title="核心配置文件"></a>核心配置文件</h3><ul>
<li><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p>
<ul>
<li><p>mybatis-config.xml</p>
<ul>
<li>configuration（配置）<ul>
<li>properties（属性）</li>
<li>settings（设置）</li>
<li>typeAliases（类型别名）</li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li>environments（环境配置）<ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider（数据库厂商标识）</li>
<li>mappers（映射器）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="环境配置（environments）"><a href="#环境配置（environments）" class="headerlink" title="环境配置（environments）"></a>环境配置（environments）</h3><ul>
<li>MyBatis 可以配置成适应多种环境</li>
<li>尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;environments default=&quot;test&quot;&gt;</span><br><span class="line">    &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=ture&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=Asia/Shanghai&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;!--测试环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;test&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>
<h4 id="事务管理器（transactionManager）"><a href="#事务管理器（transactionManager）" class="headerlink" title="事务管理器（transactionManager）"></a>事务管理器（transactionManager）</h4><ul>
<li>在 MyBatis 中有两种类型的事务管理器（也就是 type=”[JDBC | MANAGED]”）默认: JDBC</li>
<li><p>JDBC – 这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域。</p>
</li>
<li><p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br></pre></td></tr></table></figure>
<h4 id="数据源（dataSource）"><a href="#数据源（dataSource）" class="headerlink" title="数据源（dataSource）"></a>数据源（dataSource）</h4><ul>
<li>有三种内建的数据源类型（也就是 type=”[UNPOOLED|POOLED|JNDI]”） 默认： POOLED</li>
</ul>
<h3 id="属性（properties）"><a href="#属性（properties）" class="headerlink" title="属性（properties）"></a>属性（properties）</h3><ul>
<li>可以通过properties 属性来实现引用配置文件</li>
</ul>
<p><strong>编写数据库配置文件: </strong></p>
<ul>
<li>在resources下新建 db.properties:</li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">driver</span> = <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">jdbc:mysql://localhost:3306/mybatis?</span></span><br><span class="line">	<span class="attr">useSSL</span>=<span class="string">false&amp;useUnicode=ture&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">123456</span></span><br></pre></td></tr></table></figure>
<p>在核心配置文件(mybatis-config.xml)中引入:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  引入配置文件： 只能写在顶部  --&gt;</span><br><span class="line">&lt;properties resource=&quot;db.properties&quot;&gt;</span><br><span class="line">    &lt;!--内部定义变量： 如果有相同变量名， 优先使用引入的配置 --&gt;</span><br><span class="line">    &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<p>引入后即可在配置文件中使用：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;environment id=&quot;test&quot;&gt;</span><br><span class="line">    &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">    &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">    &lt;/dataSource&gt;</span><br><span class="line">&lt;/environment&gt;</span><br></pre></td></tr></table></figure>
<h3 id="typeAliases（类型别名）"><a href="#typeAliases（类型别名）" class="headerlink" title="typeAliases（类型别名）"></a>typeAliases（类型别名）</h3><ul>
<li>类型别名可为 Java 类型设置一个缩写名字。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;!-- 给类起别名 --&gt;</span><br><span class="line">    &lt;typeAlias alias=&quot;User&quot; type=&quot;com.nych.entity.User&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;!--扫描entity包，以entity包中类名为别名（首字母小写）--&gt;</span><br><span class="line">	&lt;package name=&quot;com.nych.entity&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>每一个在包 com.nych.entity 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 com.nych.entity.User 的别名为 user；</p>
</li>
<li><p>若有注解，则别名为其注解值。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;别名&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置好别名后，即可在其它地方使用该别名， 如：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;getUserList&quot; resultType=&quot;user&quot;&gt;</span><br><span class="line">    select * from `user`</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="设置（settings）"><a href="#设置（settings）" class="headerlink" title="设置（settings）"></a>设置（settings）</h3><ul>
<li>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>cacheEnabled</td>
<td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td>true \</td>
<td>false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 fetchType 属性来覆盖该项的开关状态。true \</td>
<td>false</td>
<td>true \</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>logImpl</td>
<td>logImpl</td>
<td>SLF4J \</td>
<td>LOG4J \</td>
<td>LOG4J2 \</td>
<td>JDK_LOGGING \</td>
<td>COMMONS_LOGGING \</td>
<td>STDOUT_LOGGING \</td>
<td>NO_LOGGING</td>
<td>未设置</td>
</tr>
</tbody>
</table>
</div>
<h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><ul>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）<ul>
<li>mybatis-generator-core</li>
<li>mybatis-plus</li>
<li>通用mapper</li>
</ul>
</li>
</ul>
<h3 id="映射器"><a href="#映射器" class="headerlink" title="映射器"></a>映射器</h3><ul>
<li>MapperRegistry: 在核心配置文件(mybatis-config.xml) 中注册UserMapper.xml文件</li>
<li>注册方法一：</li>
</ul>
<pre><code>&lt;mappers&gt;
    &lt;mapper resource=&quot;com/nych/dao/UserMapper.xml&quot;/&gt;
&lt;/mappers&gt;
</code></pre><ul>
<li><p>注册方法二：使用class</p>
<ul>
<li><p>接口和mapper.xml必须同名</p>
</li>
<li><p>接口和mapper.xml必须在同一个包下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper class=&quot;com.nych.dao.UserMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>注册方法三：使用包扫描</p>
<ul>
<li><p>接口和mapper.xml必须同名</p>
</li>
<li><p>接口和mapper.xml必须在同一个包下</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">     &lt;package name=&quot;com.nych.dao&quot;/&gt;</span><br><span class="line"> &lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
<h3 id="作用域和生命周期"><a href="#作用域和生命周期" class="headerlink" title="作用域和生命周期"></a>作用域和生命周期</h3><ul>
<li>不同作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的并发问题。</li>
</ul>
<p>SqlSessionFactoryBuilder:</p>
<ul>
<li><p>一旦创建了SqlsessionFactory,就不在需要它了</p>
</li>
<li><p>那么最好把它定义为局部变量（方法作用域）</p>
</li>
</ul>
<p>SqlsessionFactory:</p>
<ul>
<li>一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例</li>
</ul>
<ul>
<li>因此 SqlSessionFactory 的最佳作用域是应用作用域。</li>
</ul>
<ul>
<li>最简单的就是使用单例模式或者静态单例模式。</li>
</ul>
<p>Sqlsession：</p>
<ul>
<li><p>每个线程都应该有它自己的 SqlSession 实例。</p>
</li>
<li><p>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域 。</p>
</li>
<li><p>使用完毕，立即关闭（ 最好放在finally 块 ）。</p>
</li>
</ul>
<h2 id="ResultMap"><a href="#ResultMap" class="headerlink" title="ResultMap"></a>ResultMap</h2><p>解决属性名和字段名不一致的问题</p>
<ul>
<li>数据库中的字段</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220005272.png" alt="在这里插入图片描述"></p>
<ul>
<li>新建项目<ul>
<li>实体类中的字段</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<pre><code>@Test
public void testGetUserList()&#123;
    SqlSession sqlSession = MybatisUtils.getSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);

    User user = mapper.getUserById(1);

    System.out.println(user);

    sqlSession.close();
&#125;
</code></pre><ul>
<li>测试结果： 查不出password</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220006711.png" alt="image-20220722000627560"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from `user` where id = #&#123;id&#125;;</span><br><span class="line">			||</span><br><span class="line">select id,name,pwd from `user` where id = #&#123;id&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>解决方式一：起别名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select id,name,pwd as password from `user` where id = #&#123;id&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>解决方式二：</p>
<ul>
<li>resultMap</li>
</ul>
</li>
</ul>
<p>​            结果集映射</p>
<pre><code>&lt;!--  结果集映射  --&gt;
&lt;resultMap id=&quot;userMap&quot; type=&quot;User&quot;&gt;
    &lt;!-- column:数据库中的字段， property: 实体类中的属性 --&gt;
    &lt;result column=&quot;pwd&quot; property=&quot;password&quot;/&gt;
&lt;/resultMap&gt;

&lt;select id=&quot;getUserById&quot; resultMap=&quot;userMap&quot;&gt;
    select * from `user` where id = #&#123;id&#125;
&lt;/select&gt;
</code></pre><ul>
<li><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。</li>
<li><code>resultMap</code> 能够代替实现同等功能的数千行代码。ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</li>
</ul>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="日志工厂"><a href="#日志工厂" class="headerlink" title="日志工厂"></a>日志工厂</h3><ul>
<li>对数据库进行操作，出现了异常，我们可以使用日志进行排错。</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>设置名</th>
<th><strong>描述</strong></th>
<th>有效值</th>
<th><strong>默认值</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>logImpl</td>
<td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td>SLF4J \</td>
<td>LOG4J \</td>
<td>LOG4J2 \</td>
<td>JDK_LOGGING \</td>
<td>COMMONS_LOGGING \</td>
<td>STDOUT_LOGGING \</td>
<td>NO_LOGGING</td>
<td>未设置</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>STDOUT_LOGGING:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line"> &lt;!-- 标准日志 --&gt;</span><br><span class="line">     &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;</span><br><span class="line"> &lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p>输出的日志：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Opening JDBC Connection</span><br><span class="line">Created connection 1259652483.</span><br><span class="line">Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4b14c583]</span><br><span class="line">==&gt;  Preparing: select * from `user` where id = ?</span><br><span class="line">==&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;==    Columns: id, name, pwd</span><br><span class="line">&lt;==        Row: 1, 张三, 123456</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line">User&#123;id=1, name=&#x27;张三&#x27;, password=&#x27;123456&#x27;&#125;</span><br><span class="line">Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4b14c583]</span><br><span class="line">Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4b14c583]</span><br><span class="line">Returned connection 1259652483 to pool.</span><br></pre></td></tr></table></figure>
<h3 id="LOG4J"><a href="#LOG4J" class="headerlink" title="LOG4J"></a>LOG4J</h3><h4 id="LOG4J是什么"><a href="#LOG4J是什么" class="headerlink" title="LOG4J是什么"></a>LOG4J是什么</h4><ul>
<li>log for java</li>
<li>Log4j是Apache的一个开源项目,通过使用Log4j,我们可以控制日志信息输送的目的地是控制台、文件、GUI组件，甚至是套接口服务器、NT的事件记录器、UNIX Syslog守护进程等;</li>
</ul>
<h4 id="使用LOG4J："><a href="#使用LOG4J：" class="headerlink" title="使用LOG4J："></a>使用LOG4J：</h4><ul>
<li>导包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>log4j.properties</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码</span><br><span class="line">log4j.rootLogger=DEBUG,console,file</span><br><span class="line"></span><br><span class="line">#控制台输出的相关设置</span><br><span class="line">log4j.appender.console = org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.console.Target = System.out</span><br><span class="line">log4j.appender.console.Threshold=DEBUG</span><br><span class="line">log4j.appender.console.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.console.layout.ConversionPattern=[%c]-%m%n</span><br><span class="line"></span><br><span class="line">#文件输出的相关设置</span><br><span class="line">log4j.appender.file = org.apache.log4j.RollingFileAppender</span><br><span class="line">log4j.appender.file.File=./log/nych.log</span><br><span class="line">log4j.appender.file.MaxFileSize=10mb</span><br><span class="line">log4j.appender.file.Threshold=DEBUG</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern=[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span><br><span class="line"></span><br><span class="line">#日志输出级别</span><br><span class="line">log4j.logger.org.mybatis=DEBUG</span><br><span class="line">log4j.logger.java.sql=DEBUG</span><br><span class="line">log4j.logger.java.sql.Statement=DEBUG</span><br><span class="line">log4j.logger.java.sql.ResultSet=DEBUG</span><br><span class="line">log4j.logger.java.sql.PreparedStatement=DEBUG</span><br></pre></td></tr></table></figure>
<ul>
<li>设置日志以log4j实现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  设置  --&gt;</span><br><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>LOG4J的使用<ul>
<li>直接运行测试</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220013509.png" alt="image-20220722001342363"></p>
<ul>
<li><p>简单使用</p>
<ul>
<li>在要使用LOG4J的类中，导入org.apache.log4j.Logger</li>
</ul>
</li>
</ul>
<ul>
<li>创建日志对象，参数为当前类的class</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static Logger logger = Logger.getLogger(UserMapperTest.class);</span><br></pre></td></tr></table></figure>
<ul>
<li>日志级别</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">logger.info(&quot;info:进入testLOG4J&quot;);</span><br><span class="line">logger.debug(&quot;debug:进入了testLOG4J&quot;);</span><br><span class="line">logger.error(&quot;error: 进入了testLOG4J&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="Mybatis实现分页"><a href="#Mybatis实现分页" class="headerlink" title="Mybatis实现分页"></a>Mybatis实现分页</h2><ul>
<li>分页可以减少数据查询时间，提高效率</li>
</ul>
<h3 id="使用Limit分页"><a href="#使用Limit分页" class="headerlink" title="使用Limit分页"></a>使用Limit分页</h3><ul>
<li>sql语法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from `user` limit start,size</span><br><span class="line"></span><br><span class="line">select * from `user` limit 0,3;</span><br><span class="line">		||</span><br><span class="line">select * from `user` limit 3;</span><br></pre></td></tr></table></figure>
<ul>
<li>接口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//分页</span><br><span class="line">List&lt;User&gt; getUserLimit(Map&lt;String, Integer&gt; map);</span><br></pre></td></tr></table></figure>
<ul>
<li>实现接口（UserMapper.xml）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;getUserLimit&quot; parameterType=&quot;map&quot; resultMap=&quot;userMap&quot;&gt;</span><br><span class="line">    select * from `user` limit #&#123;start&#125;,#&#123;size&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testLimit()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();</span><br><span class="line">    map.put(&quot;start&quot;,0);</span><br><span class="line">    map.put(&quot;size&quot;,2);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = userMapper.getUserLimit(map);</span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用RowBounds分页"><a href="#使用RowBounds分页" class="headerlink" title="使用RowBounds分页"></a>使用RowBounds分页</h3><p><strong>不推荐使用</strong></p>
<ul>
<li>接口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;User&gt; getUserByRowBounds();</span><br></pre></td></tr></table></figure>
<ul>
<li>mapper.xml</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;getUserByRowBounds&quot; resultMap=&quot;userMap&quot;&gt;</span><br><span class="line">    select * from `user`</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testRowBounds()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line"></span><br><span class="line">    RowBounds rowBounds = new RowBounds(1,3);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = sqlSession.selectList(&quot;com.nych.dao.UserMapper.getUserByRowBounds&quot;, null, rowBounds);</span><br><span class="line"></span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分页插件"><a href="#分页插件" class="headerlink" title="分页插件"></a>分页插件</h3><p>pageHelper</p>
<h2 id="Mybatis注解开发"><a href="#Mybatis注解开发" class="headerlink" title="Mybatis注解开发"></a>Mybatis注解开发</h2><h3 id="注解的基本用法"><a href="#注解的基本用法" class="headerlink" title="注解的基本用法"></a>注解的基本用法</h3><ul>
<li>使用注解来映射简单语句会使代码显得更加简洁</li>
<li>但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让你本就复杂的 SQL 语句更加混乱不堪</li>
<li>因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句</li>
</ul>
<p>接口：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  //获取全部用户</span><br><span class="line">@Select(&quot;select * from user&quot;)</span><br><span class="line">  List&lt;User&gt; getUserList();</span><br><span class="line"></span><br><span class="line">//根据用户id查用户</span><br><span class="line">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span><br><span class="line">User getUserById();</span><br></pre></td></tr></table></figure>
<p>在核心配置中注册该类:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper class=&quot;com.nych.dao.UserMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testGetUserList()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    List&lt;User&gt; userList = mapper.getUserList();</span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现方法：反射机制实现</p>
<p>底层：动态代理</p>
<h3 id="注解实现CRUD"><a href="#注解实现CRUD" class="headerlink" title="注解实现CRUD"></a>注解实现CRUD</h3><p>将SQL改成自动提交：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static SqlSession getSession()&#123;</span><br><span class="line">    //openSession(true) 开启自动提交</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession(true);</span><br><span class="line">    return sqlSession;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口加注解：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface UserMapper &#123;</span><br><span class="line">    @Select(&quot;select * from user&quot;)</span><br><span class="line">List&lt;User&gt; getUserList();</span><br><span class="line"></span><br><span class="line">//根据id查找用户</span><br><span class="line">//@Param()注解在多个参数的时候，需要加上； 它可以指定参数名称</span><br><span class="line">@Select(&quot;select id,name,pwd as password from `user` where id = #&#123;userId&#125;&quot;)</span><br><span class="line">User getUserById(@Param(&quot;userId&quot;) int id);</span><br><span class="line"></span><br><span class="line">//使用注解添加一个用户</span><br><span class="line">//引用类型不需要加Param注解</span><br><span class="line">@Insert(&quot;insert into `user` (name,pwd) values(#&#123;name&#125;,#&#123;password&#125;)&quot;)</span><br><span class="line">int addUser(User user);</span><br><span class="line"></span><br><span class="line">//使用注解修改一个用户</span><br><span class="line">@Update(&quot;update `user` set `name` = #&#123;name&#125;, `pwd` = #&#123;password&#125; where id = #&#123;id&#125;&quot;)</span><br><span class="line">int updateUser(User user);</span><br><span class="line"></span><br><span class="line">//使用注解删除一个用户</span><br><span class="line">@Delete(&quot;delete from `user` where id = #&#123;id&#125;&quot;)</span><br><span class="line">int deleteUser(@Param(&quot;id&quot;) int id);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Param注解：</p>
<ul>
<li>基本类型或String 类型，需要加上</li>
<li>引用类型不需要加</li>
<li>只有一个参数的时候，可以忽略，建议加上</li>
<li>sql中引用的参数是@Param中定义的属性名</li>
</ul>
<p>{} 和 ${}的区别：</p>
<ul>
<li>{} 是 占位符 ：动态解析 -&gt; 预编译 -&gt; 执行</li>
<li>${} 是 拼接符 ：动态解析 -&gt; 编译 -&gt; 执行</li>
<li>{} 对应的变量 会 自动加上单引号</li>
<li>${} 对应的变量 不会 加上单引号</li>
<li>{}能防止sql 注入</li>
<li>${}不能防止sql 注入</li>
<li>能用 #{} 的地方就用 #{}</li>
</ul>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class UserMapperTest &#123;</span><br><span class="line">    //查询全部用户</span><br><span class="line">@Test</span><br><span class="line">public void testGetUserList()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; userList = mapper.getUserList();</span><br><span class="line"></span><br><span class="line">for (User user : userList) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//根据id查询用户</span><br><span class="line">@Test</span><br><span class="line">public void testGetUserById()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">User user = mapper.getUserById(1);</span><br><span class="line"></span><br><span class="line">System.out.println(user);</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//添加用户</span><br><span class="line">@Test</span><br><span class="line">public void testAddUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">User user = new User(&quot;注解&quot;, &quot;123456&quot;);</span><br><span class="line">int i = userMapper.addUser(user);</span><br><span class="line"></span><br><span class="line">if(i &gt; 0)&#123;</span><br><span class="line">    System.out.println(&quot;成功添加了 &quot; + i + &quot; 个用户！&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    System.out.println(&quot;添加用户失败！&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//修改用户</span><br><span class="line">@Test</span><br><span class="line">public void testUpdateUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">User user = new User(3,&quot;注解修改&quot;, &quot;123456&quot;);</span><br><span class="line">int i = userMapper.updateUser(user);</span><br><span class="line"></span><br><span class="line">if(i &gt; 0)&#123;</span><br><span class="line">    System.out.println(&quot;成功修改了 &quot; + i + &quot; 个用户！&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    System.out.println(&quot;修改用户失败！&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//删除用户</span><br><span class="line">@Test</span><br><span class="line">public void testDeleteUser()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">int i = userMapper.deleteUser(3);</span><br><span class="line"></span><br><span class="line">if (i &gt; 0)&#123;</span><br><span class="line">    System.out.println(&quot;成功删除了 &quot; + i + &quot; 个用户！&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    System.out.println(&quot;删除用户失败！&quot;);</span><br><span class="line">&#125;</span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：接口需要在核心配置文件中注册</p>
<h2 id="Lombok插件"><a href="#Lombok插件" class="headerlink" title="Lombok插件"></a>Lombok插件</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>Project Lombok 是一个 Java 库，可自动插入您的编辑器并构建工具，为您的 Java 增添趣味。<br>永远不要再编写另一个 getter 或 equals 方法，通过一个注释，您的类就有一个功能齐全的构建器，自动化您的日志变量等等。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li>在IDEA中下载安装Lombok插件<ul>
<li>在file -&gt; settings -&gt; plugins 中搜索lombok安装即可。</li>
</ul>
</li>
<li>使用Maven导入lombok的jar包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.20&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<p>@Data: 自动生成了无参构造，get, set, toString, hasacode, equals<br>@AllArgsConstructor: 生成有参构造<br>@NoArgsConstructor：生成无参构造</p>
<h2 id="多对一"><a href="#多对一" class="headerlink" title="多对一"></a>多对一</h2><p>多个学生，对应一个老师</p>
<p>对于学生来说，多个学生关联一个老师（多对一）</p>
<p>对于老师来说，集合，一个老师有多个学生（一对多）</p>
<h3 id="环境搭建-1"><a href="#环境搭建-1" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>新建数据表：</p>
<p>SQL:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table `teacher`(</span><br><span class="line">	id int(10) not null primary key auto_increment,</span><br><span class="line">	`name` varchar(30) default null</span><br><span class="line">)ENGINE = INNODB default charset=utf8;</span><br><span class="line"></span><br><span class="line">insert into `teacher` (`name`) values</span><br><span class="line">(&#x27;张老师&#x27;),</span><br><span class="line">(&#x27;李老师&#x27;);</span><br><span class="line"></span><br><span class="line">create table `student`(</span><br><span class="line">	id int(10) not null primary key auto_increment,</span><br><span class="line">	`name` varchar(30) default null,</span><br><span class="line">	`tid` int(10) default null,</span><br><span class="line">	key `fktid` (`tid`),</span><br><span class="line">	CONSTRAINT `fktid` FOREIGN KEY (`tid`) REFERENCES `teacher`(`id`)</span><br><span class="line">)ENGINE = INNODB default charset=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into `student` (`name`,`tid`) VALUES</span><br><span class="line">(&#x27;小明&#x27;,1),</span><br><span class="line">(&#x27;小红&#x27;,1),</span><br><span class="line">(&#x27;小强&#x27;,1),</span><br><span class="line">(&#x27;小王&#x27;,1);</span><br></pre></td></tr></table></figure>
<p>新建maven项目</p>
<p>新建实体类：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Student &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    //学生需要关联一个老师</span><br><span class="line">    private Teacher teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写mapper接口</p>
<p>写mapper.xml</p>
<p>在配置文件中注册mapper接口或xml文件</p>
<p>测试环境</p>
<h3 id="嵌套查询方式"><a href="#嵌套查询方式" class="headerlink" title="嵌套查询方式"></a>嵌套查询方式</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;resultMap id=&quot;StudentAndTeacher&quot; type=&quot;student&quot;&gt;</span><br><span class="line">    &lt;result property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;!--   result 只能处理单个属性，复杂属性，需要单独处理</span><br><span class="line">        对象： association</span><br><span class="line">        集合： collection</span><br><span class="line">        --&gt;</span><br><span class="line">    &lt;association property=&quot;teacher&quot; column=&quot;tid&quot; javaType=&quot;teacher&quot; select=&quot;getTeacher&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getStudents&quot; resultMap=&quot;StudentAndTeacher&quot;&gt;</span><br><span class="line">    select * from student</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getTeacher&quot; resultType=&quot;teacher&quot;&gt;</span><br><span class="line">    select * from teacher where id = #&#123;tid&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="按照结果嵌套处理"><a href="#按照结果嵌套处理" class="headerlink" title="按照结果嵌套处理"></a>按照结果嵌套处理</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  有外键的多表查询： 方法二：  --&gt;</span><br><span class="line"></span><br><span class="line">&lt;resultMap id=&quot;StudentAndTeacher2&quot; type=&quot;student&quot;&gt;</span><br><span class="line">    &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;sname&quot;/&gt;</span><br><span class="line">    &lt;association property=&quot;teacher&quot; javaType=&quot;teacher&quot;&gt;</span><br><span class="line">        &lt;result property=&quot;id&quot; column=&quot;tid&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getStudents2&quot; resultMap=&quot;StudentAndTeacher2&quot;&gt;</span><br><span class="line">    select s.id as sid, s.name as sname, tid, t.name as tname from student as s, teacher as t where s.tid = t.id</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>Mysql多对一查询方式:</p>
<ul>
<li>子查询（嵌套查询）</li>
<li>联表查询</li>
</ul>
<h2 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h2><p>一个老师有多个学生，对老师而言就是一对多的关系</p>
<h3 id="环境搭建-2"><a href="#环境搭建-2" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>实体类：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Student &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int tid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Teacher &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">//一个老师拥有多个学生</span><br><span class="line">private List&lt;Student&gt; students;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;resultMap id=&quot;TeacherAndStudents&quot; type=&quot;teacher&quot;&gt;</span><br><span class="line">    &lt;result property=&quot;id&quot; column=&quot;tid&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;</span><br><span class="line">    &lt;!--    一对多：集合使用 collection 使用 ofType--&gt;</span><br><span class="line">    &lt;collection property=&quot;students&quot; ofType=&quot;student&quot;&gt;</span><br><span class="line">        &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;name&quot; column=&quot;sname&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;tid&quot; column=&quot;tid&quot;/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getTeacher&quot; resultMap=&quot;TeacherAndStudents&quot;&gt;</span><br><span class="line">    select s.id as sid, s.name as sname, t.id as tid, t.name as tname</span><br><span class="line">    from student as s, teacher as t</span><br><span class="line">    where t.id = s.tid and t.id = #&#123;tid&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>11.2 方法二</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;resultMap id=&quot;TeacherAndStudents2&quot; type=&quot;teacher&quot;&gt;</span><br><span class="line">    &lt;result property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;collection property=&quot;students&quot; column=&quot;id&quot; javaType=&quot;ArrayList&quot; ofType=&quot;student&quot; select=&quot;getStudent&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getTeacher2&quot; resultMap=&quot;TeacherAndStudents2&quot;&gt;</span><br><span class="line">    select * from teacher where id = #&#123;tid&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;getStudent&quot; resultType=&quot;student&quot;&gt;</span><br><span class="line">    select * from student where tid = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>11.3 总结<br>关联 association（多对一）</li>
<li>集合 collection (一对多)</li>
<li>javaType 和 ofType<ul>
<li>javaType 用来指定实体类总属性的类型</li>
<li>ofType 用来指定映射到List或集合中的pojo类型，泛型中的约束类型</li>
</ul>
</li>
</ul>
<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><p>根据不同的条件生成不同的sql语句</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<h3 id="环境搭建-3"><a href="#环境搭建-3" class="headerlink" title="环境搭建"></a>环境搭建</h3><ul>
<li>创建数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `blog`(</span><br><span class="line">`id` int(30) NOT NULL primary key auto_increment COMMENT &#x27;博客id&#x27;,</span><br><span class="line">`title` VARCHAR(100) NOT NULL COMMENT &#x27;博客标题&#x27;,</span><br><span class="line">`author` VARCHAR(30) NOT NULL COMMENT &#x27;博客作者&#x27;,</span><br><span class="line">`create_time` DATETIME NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">`views` INT(30) NOT NULL COMMENT &#x27;浏览量&#x27;</span><br><span class="line">)ENGINE=INNODB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- if 查询  --&gt;</span><br><span class="line">&lt;select id=&quot;queryBlogIf&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;</span><br><span class="line">    select * from mybatis.blog where 1 = 1</span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        and title = #&#123;title&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null&quot;&gt;</span><br><span class="line">        and author = #&#123;author&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;queryBlogIf&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;</span><br><span class="line">    select * from mybatis.blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">            title = #&#123;title&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;author != null&quot;&gt;</span><br><span class="line">            and author = #&#123;author&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="choose"><a href="#choose" class="headerlink" title="choose"></a>choose</h3><ul>
<li>choose (when, otherwise)</li>
<li>类似于switch(case, default)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  choose 查询  --&gt;</span><br><span class="line">&lt;select id=&quot;queryBlogChoose&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;</span><br><span class="line">    select * from blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;choose&gt;</span><br><span class="line">            &lt;when test=&quot;title != null&quot;&gt;</span><br><span class="line">                title = #&#123;title&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;when test=&quot;author != null&quot;&gt;</span><br><span class="line">                author = #&#123;author&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;otherwise&gt;</span><br><span class="line">                views &gt; #&#123;views&#125;</span><br><span class="line">            &lt;/otherwise&gt;</span><br><span class="line">        &lt;/choose&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="trim-where-set"><a href="#trim-where-set" class="headerlink" title="trim (where, set)"></a>trim (where, set)</h3><p><strong>Set:</strong></p>
<ul>
<li>动态的在语句前添加set关键字</li>
<li>自动删除无用的逗号</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  更新  --&gt;</span><br><span class="line">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;map&quot;&gt;</span><br><span class="line">    update blog</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">        &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">            title = #&#123;title&#125;,</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;author != null&quot;&gt;</span><br><span class="line">            author = #&#123;author&#125;,</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;views != null&quot;&gt;</span><br><span class="line">            views = #&#123;views&#125;,</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">    where id = #&#123;id&#125;;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p><strong>Where:</strong></p>
<ul>
<li>如果只有一个条件，可以不写and</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;choose&gt;</span><br><span class="line">            &lt;when test=&quot;title != null&quot;&gt;</span><br><span class="line">                title = #&#123;title&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;when test=&quot;author != null&quot;&gt;</span><br><span class="line">                author = #&#123;author&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;otherwise&gt;</span><br><span class="line">                views &gt; #&#123;views&#125;</span><br><span class="line">            &lt;/otherwise&gt;</span><br><span class="line">        &lt;/choose&gt;</span><br><span class="line">    &lt;/where&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果可能有多个条件，可以去除多余的and</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;queryBlogIf&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;</span><br><span class="line">    select * from mybatis.blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">            and title = #&#123;title&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;author != null&quot;&gt;</span><br><span class="line">            and author = #&#123;author&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>trim:</p>
<ul>
<li>自定义功能</li>
<li>trim 可以完成 where 和 set 的功能</li>
</ul>
<h3 id="SQL片段"><a href="#SQL片段" class="headerlink" title="SQL片段"></a>SQL片段</h3><ul>
<li>将一些重复的sql提取出来，定义一个sql片段</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;sql id=&quot;if-title-author&quot;&gt;</span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        title = #&#123;title&#125;,</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null&quot;&gt;</span><br><span class="line">        author = #&#123;author&#125;,</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;views != null&quot;&gt;</span><br><span class="line">        views = #&#123;views&#125;,</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/sql&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  更新  --&gt;</span><br><span class="line">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;map&quot;&gt;</span><br><span class="line">    update blog</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">        &lt;!--  引用 SQL片段  --&gt;</span><br><span class="line">        &lt;include refid=&quot;if-title-author&quot;/&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">    where id = #&#123;id&#125;;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220045200.png" alt="在这里插入图片描述"></p>
<p>用法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;queryBlogForEach&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;</span><br><span class="line">    select * from blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;foreach collection=&quot;authors&quot; item=&quot;author&quot; open=&quot;author in(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">            #&#123;author&#125;</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试foreach</span><br><span class="line">@Test</span><br><span class="line">public void testForEach()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    BlogMapper blogMapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    HashMap map = new HashMap();</span><br><span class="line">    ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">    list.add(&quot;nych&quot;);</span><br><span class="line">    list.add(&quot;nyc&quot;);</span><br><span class="line">    list.add(&quot;nn&quot;);</span><br><span class="line"></span><br><span class="line">    map.put(&quot;authors&quot;,list);</span><br><span class="line"></span><br><span class="line">    List&lt;Blog&gt; blogs = blogMapper.queryBlogForEach(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果authors为空的sql语句:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from blog</span><br></pre></td></tr></table></figure>
<p>authors不为空的sql语句:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from blog WHERE author in( ? , ? , ? )</span><br></pre></td></tr></table></figure>
<h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><ul>
<li>可以创建一个变量，来保存需要的内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogsLike&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  &lt;bind name=&quot;pattern&quot; value=&quot;&#x27;%&#x27; + _parameter.getTitle() + &#x27;%&#x27;&quot; /&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><ul>
<li>查询时： 连接数据库，再查数据； 耗资源</li>
<li>那么，将一次的查询结果，暂存到内存，我们再次查询相同数据时，直接走缓存； 提高效率</li>
</ul>
<p><strong>什么是缓存：</strong></p>
<ul>
<li><p>存在内存的临时数据。</p>
</li>
<li><p>将用户经常查询的数据放到缓存（内存）中，用户查询数据时就不需要再从数据库中查数据了，直接从缓存中查询，从而提高效率，解决高并发系统的性能问题</p>
</li>
<li><p>减少和数据库的交互次数，减少系统开销，提高系统效率</p>
</li>
<li><p>经常查询不经常改变的数据，使用缓存</p>
</li>
<li><p>经常修改的数据，不建议使用缓存</p>
</li>
</ul>
<h3 id="MyBatis缓存"><a href="#MyBatis缓存" class="headerlink" title="MyBatis缓存"></a>MyBatis缓存</h3><ul>
<li>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。</li>
<li><p>MyBatis系统中默认定义了两级缓存： 一级缓存和二级缓存</p>
<ul>
<li>默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。</li>
<li>要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;cache/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><ul>
<li>一级缓存也叫本地缓存</li>
<li>默认开启，在一个sqlSession中有效</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test()&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSession();</span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">	//两次查询同一个用户    </span><br><span class="line">    User user1 = userMapper.getUserById(1);</span><br><span class="line">    System.out.println(&quot;user1 = &quot; + user1);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;-----------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    User user2 = userMapper.getUserById(1);</span><br><span class="line">    System.out.println(&quot;user2 = &quot; + user2);</span><br><span class="line">	//引用是否相同</span><br><span class="line">    System.out.println(user1 == user2);</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>连接一次数据库，执行一遍sql语句</p>
<p>第二次直接从缓存中获取</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220049318.png" alt="image-20220722004932122"></p>
<ul>
<li><p>所有 select 语句的结果将会被缓存。</p>
</li>
<li><p>所有 insert、update 和 delete 语句会刷新缓存。</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220049545.png" alt="image-20220722004954353"></p>
<ul>
<li><p>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。</p>
</li>
<li><p>缓存不会定时进行刷新（也就是说，没有刷新间隔）。</p>
</li>
<li><p>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</p>
</li>
<li><p>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</p>
</li>
</ul>
<p>手动清理缓存：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlSession.clearCache();</span><br></pre></td></tr></table></figure>
<h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><ul>
<li>二级缓存也叫全局缓存，作用域比一级缓存的高</li>
<li><p>在一个namaspace中有效，一个命名空间，对应一个二级缓存</p>
</li>
<li><p>工作方式</p>
<ul>
<li>一个会话查询一条数据后，数据会被放到当前会话的一级缓存中</li>
<li>如果会话关闭了， 这个会话对应的一级缓存中的数据会被保存到二级缓存中</li>
<li>新的会话查询信息，就可以从二级缓存中获取数据</li>
<li>不同的mapper查出的数据存放到自己对应的缓存中</li>
</ul>
</li>
</ul>
<p>要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;cache/&gt;</span><br></pre></td></tr></table></figure>
<p>这些属性可以通过 cache 元素的属性来修改。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;cache</span><br><span class="line">  eviction=&quot;FIFO&quot;</span><br><span class="line">  flushInterval=&quot;60000&quot;</span><br><span class="line">  size=&quot;512&quot;</span><br><span class="line">  readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p><strong>解释：</strong>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p>
<p><strong>清除策略：</strong></p>
<ul>
<li>LRU – 最近最少使用：移除最长时间不被使用的对象。</li>
<li>FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li>SOFT – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li>
<li>WEAK – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li>
</ul>
<p><strong>默认的清除策略是 LRU。</strong></p>
<ul>
<li><strong>flushInterval（刷新间隔）：</strong>属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</li>
<li><strong>size（引用数目）：</strong>属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</li>
<li><strong>readOnly（只读）：</strong>属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</li>
</ul>
<p><strong>提示</strong>： 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p>
<p><strong>测试：</strong></p>
<pre><code>@Test
public void TestCache()&#123;
    SqlSession sqlSession = MybatisUtils.getSession();
    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
    User user = userMapper.getUserById(1);
    System.out.println(&quot;user = &quot; + user);
    sqlSession.close();

    SqlSession sqlSession1 = MybatisUtils.getSession();
    UserMapper userMapper1 = sqlSession1.getMapper(UserMapper.class);
    User user1 = userMapper1.getUserById(1);
    System.out.println(&quot;user1 = &quot; + user1);

    System.out.println(user == user1);
    sqlSession1.close();
&#125;
</code></pre><p>结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/chahua202207220053034.png" alt="image-20220722005307819"></p>
<p>注意：</p>
<ul>
<li>如果开启二级缓存时，没有设置任何参数，实体类需要实现序列号接口（Serializable）</li>
</ul>
<h3 id="自定义缓存-ehcache"><a href="#自定义缓存-ehcache" class="headerlink" title="自定义缓存 ehcache"></a>自定义缓存 ehcache</h3><ul>
<li>Ehcache 是一种广泛使用的开源Java分布式缓存，主要面向通用缓存</li>
</ul>
<p><strong>导包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.caches&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-ehcache&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;</span><br><span class="line">        updateCheck=&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;diskStore path=&quot;./tmpdir/Tmp_EhCache&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;defaultCache</span><br><span class="line">eternal=&quot;false&quot;</span><br><span class="line">maxElementsInMemory=&quot;10000&quot;</span><br><span class="line">        overflowToDisk=&quot;false&quot;</span><br><span class="line">        diskPersistent=&quot;false&quot;</span><br><span class="line">        timeToIdleSeconds=&quot;1800&quot;</span><br><span class="line">        timeToLiveSeconds=&quot;259200&quot;</span><br><span class="line">        memoryStoreEvictionPolicy=&quot;LRU&quot;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">&lt;cache</span><br><span class="line">name=&quot;cloud_user&quot;</span><br><span class="line">eternal=&quot;false&quot;</span><br><span class="line">maxElementsInMemory=&quot;5000&quot;</span><br><span class="line">        overflowToDisk=&quot;false&quot;</span><br><span class="line">        diskPersistent=&quot;false&quot;</span><br><span class="line">        timeToIdleSeconds=&quot;1800&quot;</span><br><span class="line">        timeToLiveSeconds=&quot;1800&quot;</span><br><span class="line">        memoryStoreEvictionPolicy=&quot;LRU&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>速度上会慢一些，但是更安全，因此默认值是 false。</p>
<p><strong>提示</strong>： 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p>
<p>测试：</p>
<pre><code>@Test
public void TestCache()&#123;
    SqlSession sqlSession = MybatisUtils.getSession();
    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
    User user = userMapper.getUserById(1);
    System.out.println(&quot;user = &quot; + user);
    sqlSession.close();

    SqlSession sqlSession1 = MybatisUtils.getSession();
    UserMapper userMapper1 = sqlSession1.getMapper(UserMapper.class);
    User user1 = userMapper1.getUserById(1);
    System.out.println(&quot;user1 = &quot; + user1);

    System.out.println(user == user1);
    sqlSession1.close();
&#125;
</code></pre><p>注意：</p>
<ul>
<li>如果开启二级缓存时，没有设置任何参数，实体类需要实现序列号接口（Serializable）</li>
</ul>
<p><strong>目前：Redis数据库来做缓存！K-V</strong></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240147521.jpg" data-sites="facebook,twitter,微信,qq,Telegram"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/fd1960c6.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Mybatis-plus</div></div></a></div><div class="next-post pull-right"><a href="/posts/4.html"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240157769.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaWeb</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208230048212.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">镜中月</div><div class="author-info__description">一个有趣的博客 </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Etpkeary"><i></i><span>进入我的Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis"><span class="toc-text">MyBatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFMybatis"><span class="toc-text">什么是Mybatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Mybatis"><span class="toc-text">获取Mybatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-text">持久层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis%E4%BC%98%E5%8A%BF"><span class="toc-text">Mybatis优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAMybatis%E7%A8%8B%E5%BA%8F"><span class="toc-text">第一个Mybatis程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-text">创建一个子模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-text">编写代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">编写测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRUD"><span class="toc-text">CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#insert"><span class="toc-text">insert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select"><span class="toc-text">select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update"><span class="toc-text">update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete"><span class="toc-text">delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Map%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-text">使用Map传递参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Map%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-text">使用Map传递参数，实现添加用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Map%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-text">使用Map传递参数，实现查询用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">Mybatis 模糊查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E9%80%92%E5%AD%97%E7%AC%A6%E4%B8%B2%E2%80%9D-xxx-%E2%80%9D"><span class="toc-text">传递字符串”%xxx%”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8SQL%E4%B8%AD%E6%8B%BC%E6%8E%A5%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-text">在SQL中拼接通配符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-text">配置解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%88environments%EF%BC%89"><span class="toc-text">环境配置（environments）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%88transactionManager%EF%BC%89"><span class="toc-text">事务管理器（transactionManager）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90%EF%BC%88dataSource%EF%BC%89"><span class="toc-text">数据源（dataSource）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%EF%BC%88properties%EF%BC%89"><span class="toc-text">属性（properties）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typeAliases%EF%BC%88%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%89"><span class="toc-text">typeAliases（类型别名）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%EF%BC%88settings%EF%BC%89"><span class="toc-text">设置（settings）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-text">其他配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">映射器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">作用域和生命周期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResultMap"><span class="toc-text">ResultMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%B7%A5%E5%8E%82"><span class="toc-text">日志工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LOG4J"><span class="toc-text">LOG4J</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LOG4J%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">LOG4J是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LOG4J%EF%BC%9A"><span class="toc-text">使用LOG4J：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5"><span class="toc-text">Mybatis实现分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Limit%E5%88%86%E9%A1%B5"><span class="toc-text">使用Limit分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RowBounds%E5%88%86%E9%A1%B5"><span class="toc-text">使用RowBounds分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text">分页插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">Mybatis注解开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">注解的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0CRUD"><span class="toc-text">注解实现CRUD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lombok%E6%8F%92%E4%BB%B6"><span class="toc-text">Lombok插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">使用方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E4%B8%80"><span class="toc-text">多对一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-1"><span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="toc-text">嵌套查询方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E7%BB%93%E6%9E%9C%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86"><span class="toc-text">按照结果嵌套处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">一对多</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-2"><span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-text">方法一</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL"><span class="toc-text">动态SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-3"><span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if"><span class="toc-text">if</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choose"><span class="toc-text">choose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trim-where-set"><span class="toc-text">trim (where, set)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%89%87%E6%AE%B5"><span class="toc-text">SQL片段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreach"><span class="toc-text">foreach</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bind"><span class="toc-text">bind</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-text">缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E7%BC%93%E5%AD%98"><span class="toc-text">MyBatis缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">二级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%93%E5%AD%98-ehcache"><span class="toc-text">自定义缓存 ehcache</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d15f7828.html" title="java技术总结第一章"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java技术总结第一章"/></a><div class="content"><a class="title" href="/posts/d15f7828.html" title="java技术总结第一章">java技术总结第一章</a><time datetime="2022-09-09T08:44:27.000Z" title="发表于 2022-09-09 16:44:27">2022-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/0.html" title="无题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/posts/0.html" title="无题">无题</a><time datetime="2022-09-08T12:56:11.066Z" title="发表于 2022-09-08 20:56:11">2022-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f5f9fa9b.html" title="Docker"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker"/></a><div class="content"><a class="title" href="/posts/f5f9fa9b.html" title="Docker">Docker</a><time datetime="2022-09-04T06:42:06.000Z" title="发表于 2022-09-04 14:42:06">2022-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/66730786.html" title="K8S"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S"/></a><div class="content"><a class="title" href="/posts/66730786.html" title="K8S">K8S</a><time datetime="2022-09-04T06:41:33.000Z" title="发表于 2022-09-04 14:41:33">2022-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/undefined.html" title="Dubbo"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dubbo"/></a><div class="content"><a class="title" href="/posts/undefined.html" title="Dubbo">Dubbo</a><time datetime="2022-09-04T06:40:34.000Z" title="发表于 2022-09-04 14:40:34">2022-09-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 镜中月</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script data-pjax defer src="/js/custom/fixed_comment.js"></script><div class="aplayer no-destroy" data-id="2780742094" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
    if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.addEventListener('controllerchange', function() {
            showNotification()
        })
    }
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
    })
}
function showNotification() {
    if (GLOBAL_CONFIG.Snackbar) {
        var snackbarBg =
            document.documentElement.getAttribute('data-theme') === 'light' ?
                GLOBAL_CONFIG.Snackbar.bgLight :
                GLOBAL_CONFIG.Snackbar.bgDark
        var snackbarPos = GLOBAL_CONFIG.Snackbar.position
        Snackbar.show({
            text: '✨ 有新文章啦！ 👉',
            backgroundColor: snackbarBg,
            duration: 500000,
            pos: snackbarPos,
            actionText: '🍗点击食用🍔',
            actionTextColor: '#fff',
            onActionClick: function(e) {
                location.reload()
            },
        })
    } else {
        var showBg =
            document.documentElement.getAttribute('data-theme') === 'light' ?
                '#49b1f5' :
                '#1f1f1f'
        var cssText = `top: 0; background: ${showBg};`
        document.getElementById('app-refresh').style.cssText = cssText
    }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208221716533.jpg);"> <a class="categoryBar-list-link" href="categories/笔记整合/">笔记整合</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">笔记</span></li><li class="categoryBar-list-item" style="background:url(https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208221805793.jpg);"> <a class="categoryBar-list-link" href="categories/Mybatis/">Mybatis</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">技术分享</span></li><li class="categoryBar-list-item" style="background:url(https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208221811855.jpg);"> <a class="categoryBar-list-link" href="categories/Hello-World/">Hello World</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">杂谈教程</span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" href="categories/记录/">记录</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" href="categories/计算机网络/">计算机网络</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" href="categories/前端三件套/">前端三件套</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v3.8.2" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用双线部署，默认线路托管于Vercel" title=""><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用双线部署，联通线路托管于Coding" title=""><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/2.html" alt=""><img width="48" height="48" src="https://cdn.jsdelivr.net/gh/liuloin/lanling_img@main/img/BlogImages202208240157768.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-06-23</span><a class="blog-slider__title" href="posts/2.html" alt="">Hello World</a><div class="blog-slider__text">Hello World</div><a class="blog-slider__button" href="posts/2.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/1.html" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/l3/wallhaven-l3xk6q.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-06-23</span><a class="blog-slider__title" href="posts/1.html" alt="">第一篇博客</a><div class="blog-slider__text">第一篇博客</div><a class="blog-slider__button" href="posts/1.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://cdn.cbd.int/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://python-github-calendar-api-spk83h666-anzhiyu-c.vercel.app/api?Etpkeary",['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'],'Etpkeary')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>